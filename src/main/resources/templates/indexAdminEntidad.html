<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPPS - Universidad Nacional de R√≠o Negro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos generales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        /* Estilos para las cards de secci√≥n */
        .section-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            padding: 20px;
            overflow: visible;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #002642;
        }

        .section-header h1 {
            color: #002642;
            margin: 0;
            font-size: 24px;
        }

        /* Estilos para los filtros */
        .filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 200px;
        }

        .filter-group label {
            font-weight: 500;
            color: #002642;
            white-space: nowrap;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            min-width: 150px;
        }

        .filter-actions {
            margin-left: auto;
        }

        /* Estilos para las tablas */
        .table-container {
            overflow: visible;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
        }

        thead {
            background-color: #002642;
            color: white;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            font-weight: 600;
            text-transform: uppercase;
            font-size: 14px;
        }

        tbody tr:hover {
            background-color: #f8f9fa;
        }

        /* Estilos para los estados */
        .status-active {
            color: #28a745;
            font-weight: 500;
        }

        .status-inactive {
            color: #dc3545;
            font-weight: 500;
        }

        .status-pending {
            color: #ffc107;
            font-weight: 500;
        }

        .status-completed {
            color: #17a2b8;
            font-weight: 500;
        }

        /* Estilos para los botones de acci√≥n */
        .actions {
            display: flex;
            gap: 8px;
        }

        .btn.small {
            padding: 6px 10px;
            font-size: 12px;
        }

        /* Encabezado */
        header {
            background-color: #002642;
            color: white;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo-container {
            padding: 5px 0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

     .user-name {
    color: white;
    font-weight: bold;
    font-family: Arial, sans-serif; /* Asegura la tipograf√≠a */
}

        .sub-header {
            background-color: #001a33;
            padding: 10px 20px;
            border-bottom: 1px solid #004672;
            color: white;
        }

        .propuesta {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: 10px;
        }

        .propuesta select {
            padding: 5px 10px;
            border: 1px solid #004672;
            border-radius: 4px;
            background-color: #002642;
            color: white;
        }

        /* Navegaci√≥n */
        nav {
            background-color: #003a63;
            border-bottom: 1px solid #004672;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
        }

        .main-menu {
            display: flex;
            list-style: none;
            max-width: 1200px;
            margin: 0 auto;
        }

        .main-menu li {
            position: relative;
        }

        .main-menu li a {
            display: block;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
        }

        .main-menu li a:hover {
            background-color: #003152;
        }

        .main-menu li.active a {
            position: relative;
            background-color: #e50019;
            font-weight: bold;
        }

        .profile-menu {
            padding: 15px 20px;
            color: white;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .icon-separator {
            width: 1px;
            height: 20px;
            background-color: rgba(255, 255, 255, 0.3);
        }

        /* Contenido principal */
        main {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        h1 {
            color: #002642;
            margin-bottom: 20px;
            font-size: 24px;
        }

        /* Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        .status-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: flex-start;
        }

        .projects-list {
            display: grid;
            gap: 15px;
        }

        .project-item {
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .project-item:last-child {
            border-bottom: none;
        }

        /* Botones */
        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            background-color: #002642;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #003152;
        }

        .btn.secondary {
            background-color: #800020;  /* Color bordo */
            color: white;
        }

        .btn.secondary:hover {
            background-color: #600018;  /* Color bordo m√°s oscuro al hover */
        }

        /* Footer */
        footer {
            background-color: #002642;
            color: white;
            padding: 20px;
            margin-top: 40px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                text-align: center;
            }

            .user-info {
                margin-top: 10px;
            }

            .profile-menu {
                flex-direction: column;
                gap: 10px;
            }

            .icon-separator {
                display: none;
            }

            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        /* Estilos para modales */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #002642;
        }

        .modal-header h2 {
            color: #002642;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #002642;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }

        /* ===== ESTILOS PARA DESPLEGABLE DE ACTIVIDADES ===== */

/* Contenedor principal del desplegable */
.actividades-dropdown {
    position: relative;
    display: inline-block;
    width: 100%;
}

/* Bot√≥n para abrir/cerrar el desplegable */
.actividades-toggle {
    background-color: #f8f9fa;
    border: 1px solid #ddd;
    padding: 8px 12px;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    transition: all 0.3s ease;
    width: 100%;
    font-size: 14px;
    color: #002642;
    font-weight: 500;
}

.actividades-toggle:hover {
    background-color: #e9ecef;
    border-color: #002642;
}

.actividades-toggle i {
    color: #002642;
}

/* Contenido del desplegable */
.actividades-content {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    max-height: 400px;
    overflow-y: auto;
    min-width: 350px;
    margin-top: 2px;
    display: none;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
}

.actividades-content.mostrar {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

/* Items individuales de actividad */
.actividad-item {
    padding: 15px;
    border-bottom: 1px solid #f1f3f4;
    transition: background-color 0.2s ease;
}

.actividad-item:last-child {
    border-bottom: none;
}

.actividad-item:hover {
    background-color: #f8f9fa;
}

/* Header de cada actividad */
.actividad-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.actividad-header strong {
    color: #002642;
    font-size: 14px;
    font-weight: 600;
}

/* Badge de horas */
.actividad-horas {
    background-color: #002642;
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}

/* Detalles de la actividad */
.actividad-details {
    font-size: 13px;
    line-height: 1.5;
}

.actividad-details p {
    margin: 6px 0;
    color: #333;
}

.actividad-details strong {
    color: #002642;
    font-weight: 500;
}

/* Resumen de actividades */
.actividades-summary {
    padding: 15px;
    background-color: #f8f9fa;
    border-top: 1px solid #ddd;
    text-align: center;
    font-weight: 600;
    color: #002642;
}

/* Mensaje cuando no hay actividades */
.no-actividades {
    padding: 30px 20px;
    text-align: center;
    color: #6c757d;
}

.no-actividades p {
    margin: 0;
    font-style: italic;
}

/* ===== ESTILOS PARA BADGES DE ESTADO ===== */

.status-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
    display: inline-block;
}

/* Estados espec√≠ficos que coinciden con tu paleta */
.status-pending {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.status-in-progress {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

.status-completed {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.status-draft {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

/* ===== MENSAJE CUANDO NO HAY DATOS ===== */

.no-data {
    text-align: center;
    padding: 40px 20px;
    color: #6c757d;
}

.no-data i {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
    color: #002642;
}

.no-data p {
    margin: 10px 0;
    font-size: 16px;
}

.no-data .btn {
    margin-top: 15px;
}

/* ===== MEJORAS PARA ACCIONES DE TABLA ===== */

.table-actions {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 15px;
    gap: 10px;
}

.table-actions .btn {
    display: flex;
    align-items: center;
    gap: 8px;
}

/* ===== RESPONSIVE PARA EL DESPLEGABLE ===== */

/* REEMPLAZAR desde l√≠nea ~620 */
@media (max-width: 768px) {
    .actividades-content {
        min-width: 280px;
        max-height: 300px;
        left: -50px; /* ‚úÖ AGREGAR ESTA L√çNEA */
    }

    .actividad-item {
        padding: 12px;
    }

    .actividad-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }

    .actividades-toggle {
        font-size: 13px;
        padding: 6px 10px;
    }
}

/* ===== ANIMACIONES SUAVES ===== */

.actividades-content {
    animation: slideDown 0.2s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ===== SCROLL PERSONALIZADO PARA EL DESPLEGABLE ===== */

.actividades-content::-webkit-scrollbar {
    width: 6px;
}

.actividades-content::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 3px;
}

.actividades-content::-webkit-scrollbar-thumb {
    background: #002642;
    border-radius: 3px;
}

.actividades-content::-webkit-scrollbar-thumb:hover {
    background: #003152;
}

/* ===== MEJORAS PARA LA TABLA DE PLANES ===== */

.plan-table .actividades-dropdown {
    min-width: 120px;
}

/* Asegurar que el desplegable no se corte en la tabla */
.table-container {
    overflow: visible;
}

.plan-table td {
    position: relative;
    overflow: visible;
}

.actividades-content.align-right {
    left: auto;
    right: 0;
}

.table-container {
    overflow: visible !important;
}

.plan-table {
    overflow: visible !important;
}

.notification-container {
    position: relative;
}

.notification-icon {
    cursor: pointer;
    position: relative;
    padding: 5px;
}

.notification-badge {
    position: absolute;
    top: 0;
    right: 0;
    background-color: red;
    color: white;
    font-size: 0.7em;
    padding: 2px 6px;
    border-radius: 50%;
}

.notification-dropdown {
    position: absolute;
    right: 0;
    top: 35px;
    background: white;
    color: black;
    width: 300px;
    max-height: 400px;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    z-index: 1000;
    overflow-y: auto;
}

.notificacion-lista {
    padding: 10px;
}

.notificacion-item {
    padding: 10px;
    border-bottom: 1px solid #ccc;
    font-size: 0.9em;
    display: flex;
    align-items: flex-start;
    gap: 8px;
}

.notificacion-item.unread {
    font-weight: bold;
    background-color: #f0f8ff;
}

.notificacion-item i {
    margin-top: 2px;
}

.notificacion-footer {
    padding: 10px;
    text-align: center;
    background-color: #f8f9fa;
}
    </style>
</head>
<body>
<header>
    <div class="header-container">
        <div class="logo-container">
            <img src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-So2CHeud6JF1xVNp1LlSIuwt3sgVUg.png"
                 width=70 alt="Logo UNRN" class="logoUNRN">
            <img src="https://lh3.googleusercontent.com/a-/ALV-UjVX7tQfNfC44NY6OR_Fwc7MJze4ucpzRbw1lXa0yPCWLi6cuJkC=s129-p-k-rw-no"
                 width=100 alt="Logo LIA" class="logoLIA">
        </div>
        <div class="user-info">
            <div class="user-dropdown">
                <span class="user-name" th:text="${admin.nombre + ' ' + admin.apellido + ' üèõÔ∏è‚Äçüíª'}">Administrador de entidades üèõÔ∏è‚Äçüíª</span>
            </div>
        </div>
    </div>

    <div class="sub-header">
        <div class="propuesta">
            <span>Propuesta:</span>
            <select id="admin-select" onchange="if(this.value==='logout'){window.location.href='login.html';}">
                <option value="admin">Administraci√≥n</option>
                <option value="logout">Cerrar sesi√≥n</option>
            </select>
        </div>
    </div>
</header>
<nav>
    <ul class="main-menu">
        <li><a href="#tutor-externo-fields">Tutores</a></li>
        <li><a href="#convenio-table">Convenios</a></li>
        <li><a href="#proyecto-table">Proyectos</a></li>
        <li><a href="#plan-table">Planes</a></li>
    </ul>
    <div class="profile-menu">
        <div class="notification-container">
    <span class="notification-icon">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" id="notificacion-count" style="display:none;">0</span>
    </span>
            <div class="notification-dropdown" id="notification-dropdown" style="display: none;">
                <div id="notificacion-lista" class="notificacion-lista">
                    <p style="text-align:center; padding: 10px;">Cargando notificaciones...</p>
                </div>
                <div class="notificacion-footer">
                    <button class="btn secondary" onclick="marcarTodasLeidas()">Marcar todas como le√≠das</button>
                </div>
            </div>
        </div>

        <span>Perfil: Administrador Entidad </span>
    </div>
</nav>


<main>
    <section id="user-section" class="section-card">
        <div class="section-header">
            <h1 id="user-table">Gesti√≥n de Tutores</h1>
            <button class="section-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <i class="fas fa-arrow-up"></i> Subir
            </button>
        </div>

        <div class="filters-container">
            <div class="filter-group">
                <label for="status-filter">Estado:</label>
                <select id="status-filter">
                    <option value="">Todos</option>
                    <option value="active">Activo</option>
                    <option value="inactive">Inactivo</option>
                    <option value="pending">Pendiente</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="search-user">Buscar:</label>
                <input type="text" id="search-user" placeholder="Nombre, DNI o email">
            </div>

            <div class="filter-actions">
                <button class="btn secondary">Filtrar</button>
            </div>
        </div>

        <div class="table-actions">
            <button class="btn primary" id="add-user-btn">
                <i class="fas fa-user-plus"></i> Agregar Tutor
            </button>
        </div>

        <div class="table-container">
            <table class="user-table">
                <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="tutor : ${tutores}">
                    <td th:text="${tutor.nombre + ' ' + tutor.apellido}">Nombre Apellido</td>
                    <td th:text="${tutor.email}">email@ejemplo.com</td>
                    <td class="actions">
                        <button class="btn small edit-user-btn" th:attr="data-id=${tutor.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn small">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>


    <section id="proyecto-section" class="section-card">
        <div class="section-header">
            <h1 id="proyecto-table">Gesti√≥n de Proyectos</h1>
            <button class="section-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <i class="fas fa-arrow-up"></i> Subir
            </button>
        </div>

        <div class="table-container">

            <div class="filters-container">
                <div class="filter-group">
                    <label for="status-filter">Estado:</label>
                    <select id="status-filter">
                        <option value="">Todos</option>
                        <option value="active">Activo</option>
                        <option value="inactive">Inactivo</option>
                        <option value="pending">Pendiente</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="search-proyecto">Buscar:</label>
                    <input type="text" id="search-proyecto" placeholder="T√≠tulo, √°rea, tutor o fecha">
                </div>

                <div class="filter-actions">
                    <button class="btn secondary">Filtrar</button>
                </div>
            </div>

            <div class="table-actions">
                <button class="btn primary" onclick="abrirModal('add-proyecto-modal')">
                    <i class="fas fa-plus"></i> Nuevo Proyecto
                </button>
            </div>

            <table class="proyecto-table">
                <thead>
                <tr>
                    <th>T√≠tulo</th>
                    <th>√Årea</th>
                    <th>Tutor designado</th>
                    <th>Fecha de inicio</th>
                    <th>Fecha de finalizaci√≥n</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="proyecto : ${proyectos}">
                    <td th:text="${proyecto.proyectoId.titulo}">T√≠tulo</td>
                    <td th:text="${proyecto.area != null ? proyecto.area.nombre : 'Sin √°rea asignada'}">√Årea</td>
                    <td th:text="${proyecto.tutorExterno != null ? proyecto.tutorExterno.nombre + ' ' + proyecto.tutorExterno.apellido : 'Sin asignar'}">
                        Tutor designado
                    </td>
                    <td th:text="${proyecto.planDeTrabajo != null ? #temporals.format(proyecto.planDeTrabajo.fechaInicio, 'dd/MM/yyyy') : 'Sin definir'}">
                        Fecha de inicio
                    </td>
                    <td th:text="${proyecto.planDeTrabajo != null ? #temporals.format(proyecto.planDeTrabajo.fechaFin, 'dd/MM/yyyy') : 'Sin definir'}">
                        Fecha de finalizaci√≥n
                    </td>
                    <td>
                        <!-- ‚úÖ Estado din√°mico CORREGIDO con expresiones v√°lidas -->
                        <span class="status-badge"
                              th:if="${proyecto.planDeTrabajo != null}"
                              th:classappend="${T(java.time.LocalDate).now().isAfter(proyecto.planDeTrabajo.fechaFin) ? 'status-completed' :
                                          (!T(java.time.LocalDate).now().isBefore(proyecto.planDeTrabajo.fechaInicio) ? 'status-in-progress' : 'status-pending')}"
                              th:text="${T(java.time.LocalDate).now().isAfter(proyecto.planDeTrabajo.fechaFin) ? 'Finalizado' :
                                   (!T(java.time.LocalDate).now().isBefore(proyecto.planDeTrabajo.fechaInicio) ? 'En curso' : 'Pendiente')}">
                        Estado
                    </span>

                        <!-- Estado cuando no tiene plan -->
                        <span class="status-badge status-draft" th:if="${proyecto.planDeTrabajo == null}">
                        Sin plan asignado
                    </span>
                    </td>
                    <td class="actions">
                        <button class="btn small edit-user-btn" th:attr="data-id=${proyecto.proyectoId.titulo}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn small">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- SECTION: Gesti√≥n de Planes de Trabajo con bot√≥n "Nuevo Plan" -->
    <section id="plan-section" class="section-card">
        <div class="section-header">
            <h1 id="plan-table">Gesti√≥n de Planes de Trabajo</h1>
            <!-- ‚úÖ Bot√≥n directo al modal (igual que proyecto) -->

            <button class="section-top-btn" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
                <i class="fas fa-arrow-up"></i> Subir
            </button>
        </div>

        <div class="table-container">

            <div class="filters-container">
                <div class="filter-group">
                    <label for="status-filter">Estado:</label>
                    <select id="status-filter">
                        <option value="">Todos</option>
                        <option value="active">Activo</option>
                        <option value="inactive">Inactivo</option>
                        <option value="pending">Pendiente</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="search-plan">Buscar:</label>
                    <input type="text" id="search-plan" placeholder="Numero, Proyecto o fecha">
                </div>

                <div class="filter-actions">
                    <button class="btn secondary">Filtrar</button>
                </div>
            </div>

            <div class="table-actions">
                <button class="btn primary" onclick="abrirModal('add-plan-modal')">
                    <i class="fas fa-plus"></i> Nuevo Plan
                </button>
            </div>

            <table class="plan-table">
                <thead>
                <tr>
                    <th>N¬∞ Plan</th>
                    <th>Proyecto</th>
                    <th>Inicio</th>
                    <th>Fin</th>
                    <th>Actividades</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                <!-- ‚úÖ L√≥gica CORREGIDA para mostrar planes din√°micamente -->
                <tr th:each="plan : ${planesDeTrabajo}"
                    th:if="${planesDeTrabajo != null and !planesDeTrabajo.isEmpty()}">
                    <td th:text="${plan.planDeTrabajoId.numero}">N¬∞ Plan</td>
                    <td th:text="${plan.proyecto.proyectoId.titulo}">Proyecto</td>
                    <td th:text="${#temporals.format(plan.fechaInicio, 'dd/MM/yyyy')}">Inicio</td>
                    <td th:text="${#temporals.format(plan.fechaFin, 'dd/MM/yyyy')}">Fin</td>
                    <td>
                        <!-- ‚úÖ Desplegable de actividades --> <!-- se rompe, deber√≠a mostrarse el desplegable completo una vez abierto incluso por fuera de la section -->
                        <div class="actividades-dropdown">
                            <button class="btn small actividades-toggle"
                                    th:attr="data-plan-id=${plan.planDeTrabajoId.numero}"
                                    onclick="toggleActividades(this)">
                                    <span>
                                        <i class="fas fa-list"></i>
                                        <span th:text="${plan.actividades != null ? plan.actividades.size() : 0}">0</span>
                                        Actividades
                                    </span>
                                <i class="fas fa-chevron-down toggle-icon"></i> <!-- ‚úÖ AGREGAR clase toggle-icon -->
                            </button>

                            <div class="actividades-content"
                                 th:attr="id='actividades-' + ${plan.planDeTrabajoId.numero}">
                                <div th:if="${plan.actividades == null or plan.actividades.isEmpty()}"
                                     class="no-actividades">
                                    <p>No hay actividades asignadas</p>
                                </div>

                                <div th:each="actividad : ${plan.actividades}" class="actividad-item">
                                    <div class="actividad-header">
                                        <strong th:text="'Actividad ' + ${actividad.actividadId.numero}">Actividad 1</strong>
                                        <span class="actividad-horas" th:text="${actividad.cantidadHoras} + ' hrs'">20 hrs</span>
                                    </div>
                                    <div class="actividad-details">
                                        <p><strong>Nombre:</strong> <span th:text="${actividad.nombre}">Nombre actividad</span></p>
                                        <p><strong>Descripci√≥n:</strong> <span th:text="${actividad.descripcion}">Descripci√≥n</span></p>
                                        <p><strong>Fecha l√≠mite:</strong>
                                            <span th:text="${actividad.fechaLimite != null ? #temporals.format(actividad.fechaLimite, 'dd/MM/yyyy') : 'Sin definir'}">Sin definir</span>
                                        </p>
                                    </div>
                                </div>

                                <div th:if="${plan.actividades != null and !plan.actividades.isEmpty()}" class="actividades-summary">
                                    <strong>Total horas: </strong>
                                    <span th:text="${#aggregates.sum(plan.actividades.![cantidadHoras])} + ' hrs'">75 hrs</span>
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <!-- ‚úÖ Estado din√°mico CORREGIDO con expresiones v√°lidas -->
                        <span class="status-badge"
                              th:classappend="${T(java.time.LocalDate).now().isAfter(plan.fechaFin) ? 'status-completed' :
                                          (!T(java.time.LocalDate).now().isBefore(plan.fechaInicio) ? 'status-in-progress' : 'status-pending')}"
                              th:text="${T(java.time.LocalDate).now().isAfter(plan.fechaFin) ? 'Finalizado' :
                                   (!T(java.time.LocalDate).now().isBefore(plan.fechaInicio) ? 'En curso' : 'Pendiente')}">
                        Estado
                    </span>
                    </td>
                    <td class="actions">
                        <button class="btn small edit-plan-btn" th:attr="data-plan-id=${plan.planDeTrabajoId.numero}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn small delete-plan-btn" th:attr="data-plan-id=${plan.planDeTrabajoId.numero}">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </td>
                </tr>

                <!-- Mensaje cuando no hay planes -->
                <tr th:if="${planesDeTrabajo == null or planesDeTrabajo.isEmpty()}">
                    <td colspan="7" class="no-data">
                        <i class="fas fa-tasks"></i>
                        <p>No hay planes de trabajo registrados</p>
                        <button class="btn primary" onclick="abrirModal('add-plan-modal')">
                            Crear primer plan
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- Modal Agregar tutor -->
    <div id="add-user-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Agregar Tutor</h2>
                <button class="modal-close" onclick="cerrarModal('add-user-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-user-form" th:action="@{/admin-entidad/guardarTutor}" method="post" th:object="${tutor}">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="form-group">
                        <label for="nombre">Nombre:</label>
                        <input type="text" id="nombre" th:field="*{nombre}" required/>
                    </div>
                    <div class="form-group">
                        <label for="apellido">Apellido:</label>
                        <input type="text" id="apellido" th:field="*{apellido}" required/>
                    </div>
                    <div class="form-group">
                        <label for="password">Contrase√±a:</label>
                        <input type="password" id="password" th:field="*{password}" required/>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" th:field="*{email}" required/>
                    </div>
                    <div class="form-group">
                        <label for="telefono">Tel√©fono:</label>
                        <input type="tel" id="telefono" th:field="*{telefono}"/>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn secondary modal-close-btn">Cancelar</button>
                        <button type="submit" class="btn primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Proyecto -->
    <div id="add-proyecto-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nuevo Proyecto</h2>
                <button class="modal-close" onclick="cerrarModal('add-proyecto-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-proyecto-form" th:action="@{/admin-entidad/guardarProyecto}" method="post"
                      th:object="${proyecto}">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <div class="form-group">
                        <label for="titulo">T√≠tulo:</label>
                        <input type="text" id="titulo" th:field="*{proyectoId.titulo}" required/>
                    </div>

                    <div class="form-group">
                        <label for="area">√Årea:</label>
                        <select id="area" th:field="*{area.nombre}" required>
                            <option value="" disabled selected>Seleccion√° un √°rea</option>
                            <option th:each="a : ${areas}" th:value="${a.nombre}" th:text="${a.nombre}"></option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tutorExterno">Tutor:</label>
                        <select id="tutorExterno" th:field="*{tutorExterno.id}">
                            <option value="">Sin tutor asignado</option>
                            <option th:each="t : ${tutores}" th:value="${t.id}"
                                    th:text="${t.nombre + ' ' + t.apellido}"></option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="descripcion">Descripci√≥n:</label>
                        <textarea id="descripcion" th:field="*{descripcion}" required></textarea>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn secondary modal-close-btn">Cancelar</button>
                        <button type="submit" class="btn primary">Guardar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Agregar Plan de Trabajo - VERSI√ìN MEJORADA -->
    <div id="add-plan-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Nuevo plan de trabajo</h2>
                <button class="modal-close" onclick="cerrarModal('add-plan-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Mostrar mensaje si no hay proyectos disponibles -->
                <div th:if="${proyectosSinPlan == null or #lists.isEmpty(proyectosSinPlan)}"
                     class="alert alert-warning">
                    <h4>No hay proyectos disponibles</h4>
                    <p>Para crear un plan de trabajo, primero debe agregar proyectos a su entidad.</p>
                    <button type="button" class="btn primary"
                            onclick="cerrarModal('add-plan-modal'); abrirModal('add-proyecto-modal')">
                        Agregar Proyecto Primero
                    </button>
                </div>

                <!-- Formulario de plan (solo si hay proyectos) -->
                <form th:if="${proyectosSinPlan != null and not #lists.isEmpty(proyectosSinPlan)}"
                      th:action="@{/admin-entidad/guardarPlan}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                    <div class="form-group">
                        <label for="numeroPlan">N√∫mero:</label>
                        <input type="number" id="numeroPlan" name="numeroPlan" required/>
                    </div>

                    <div class="form-group">
                        <label for="fechaInicio">Fecha inicio:</label>
                        <input type="date" id="fechaInicio" name="fechaInicio" required/>
                    </div>

                    <div class="form-group">
                        <label for="fechaFin">Fecha fin:</label>
                        <input type="date" id="fechaFin" name="fechaFin" required/>
                    </div>

                    <div class="form-group">
                        <label for="proyectoSelect">Proyecto:</label>
                        <select id="proyectoSelect" name="tituloProyecto" required>
                            <option value="">Seleccion√° un proyecto...</option>
                            <option th:each="p : ${proyectosSinPlan}"
                                    th:value="${p.proyectoId.titulo}"
                                    th:text="|${p.proyectoId.titulo} - ${p.estado}|">
                            </option>
                        </select>
                        <small class="form-text text-muted">
                            Solo se muestran proyectos sin plan de trabajo asignado.
                        </small>
                    </div>

                    <div class="form-group">
                        <button type="button" class="btn secondary" onclick="abrirModal('actividad-modal')">
                            Agregar Actividad
                        </button>
                    </div>

                    <!-- Lista de actividades cargadas -->
                    <div class="form-group">
                        <h4>Actividades cargadas:</h4>
                        <div th:if="${planForm.actividades == null or #lists.isEmpty(planForm.actividades)}"
                             class="alert alert-info">
                            <em>No hay actividades agregadas a√∫n. Haga clic en "Agregar Actividad" para comenzar.</em>
                        </div>
                        <ul id="listaActividades"
                            th:if="${planForm.actividades != null and not #lists.isEmpty(planForm.actividades)}">
                            <li th:each="a, stat : ${planForm.actividades}"
                                th:text="|${stat.index + 1}. ${a.nombre} - ${a.cantidadHoras} horas|">
                                <!-- Bot√≥n para eliminar actividad -->
                                <form th:action="@{/admin-entidad/eliminarActividad}" method="post"
                                      style="display: inline;">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                    <input type="hidden" name="indice" th:value="${stat.index}"/>
                                    <button type="submit" class="btn-small btn-danger"
                                            onclick="return confirm('¬øEst√° seguro de eliminar esta actividad?')">
                                        √ó
                                    </button>
                                </form>
                            </li>
                        </ul>
                        <div th:if="${planForm.actividades != null and not #lists.isEmpty(planForm.actividades)}"
                             class="total-horas">
                            <strong>Total de horas: <span th:text="${planForm.totalHoras}">0</span></strong>
                        </div>
                    </div>

                    <!-- Footer de botones -->
                    <div class="modal-footer">
                        <button type="button" class="btn secondary" onclick="cerrarModal('add-plan-modal')">Cancelar
                        </button>
                        <button type="submit" class="btn primary"
                                th:disabled="${planForm.actividades == null or #lists.isEmpty(planForm.actividades)}">
                            Confirmar Plan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Actividad -->
    <!-- Modal Actividad (actualizado) -->
    <div id="actividad-modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="cerrarModal('actividad-modal')">&times;</span>
            <h3>Crear Nueva Actividad</h3>

            <form th:action="@{/admin-entidad/agregarActividad}" method="post" th:object="${actividad}">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                <div class="form-group">
                    <label for="nombre">Nombre de la Actividad</label>
                    <input type="text" id="nombre" th:field="*{nombre}" required>
                </div>

                <div class="form-group">
                    <label for="descripcion">Descripci√≥n</label>
                    <textarea id="descripcion" th:field="*{descripcion}" required></textarea>
                </div>

                <div class="form-group">
                    <label for="cantidadHoras">Horas Estimadas</label>
                    <input type="number" id="cantidadHoras" th:field="*{cantidadHoras}" min="0" required>
                </div>

                <div class="form-group">
                    <label for="fechaLimite">Fecha L√≠mite</label>
                    <input type="date" id="fechaLimite" th:field="*{fechaLimite}" required
                           th:min="${#temporals.format(#temporals.createNow(), 'yyyy-MM-dd')}"
                           th:value="${#temporals.format(#temporals.createNow().plusDays(7), 'yyyy-MM-dd')}">
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn secondary" onclick="cerrarModal('actividad-modal')">Cancelar</button>
                    <button type="submit" class="btn primary">Agregar</button>
                </div>
            </form>
        </div>
    </div>

</main>

<footer>
    <div class="footer-content">
        <p>&copy; 2025 Universidad Nacional de R√≠o Negro - Sistema de Gesti√≥n de Pr√°cticas Profesionales
            Supervisadas</p>
    </div>
</footer>

<script th:inline="javascript">
    // Estas variables ser√°n le√≠das por el script principal
    var abrirModalPlan = /*[[${abrirModalPlan}]]*/ false;
    var abrirModalActividad = /*[[${abrirModalActividad}]]*/ false;
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
    // ==================== GESTI√ìN DE BOTONES Y MODALES ====================

    // Botones para abrir modales
    const addUserBtn = document.getElementById('add-user-btn');
    const addConvenioBtn = document.getElementById('add-convenio-btn');
    const addProyectoBtn = document.getElementById('add-proyecto-btn');
    const addPlanBtn = document.getElementById('add-plan-btn');

    // Modales y botones de cierre
    const modals = document.querySelectorAll('.modal');
    const modalCloseBtns = document.querySelectorAll('.modal-close, .modal-close-btn');

    // Event listeners para abrir modales
    if (addUserBtn) {
        addUserBtn.addEventListener('click', () => abrirModal('add-user-modal'));
    }
    if (addConvenioBtn) {
        addConvenioBtn.addEventListener('click', () => abrirModal('add-convenio-modal'));
    }
    if (addProyectoBtn) {
        addProyectoBtn.addEventListener('click', () => abrirModal('add-proyecto-modal'));
    }
    if (addPlanBtn) {
        addPlanBtn.addEventListener('click', () => abrirModal('add-plan-modal'));
    }

    // Event listeners para cerrar modales
    modalCloseBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Encontrar el modal padre y cerrarlo
            const modal = btn.closest('.modal');
            if (modal) {
                cerrarModal(modal.id);
            }
        });
    });

    // Cerrar modal al hacer click fuera de √©l
    window.addEventListener('click', function(e) {
        modals.forEach(modal => {
            if (e.target === modal) {
                cerrarModal(modal.id);
            }
        });
    });

    // ==================== APERTURA AUTOM√ÅTICA DE MODALES ====================

    // Variables inyectadas desde Thymeleaf
    var abrirModalPlan = /*[[${abrirModalPlan}]]*/ false;
    var abrirModalActividad = /*[[${abrirModalActividad}]]*/ false;

    // Abrir modales seg√∫n par√°metros del controller
    if (abrirModalPlan === true) {
        abrirModal('add-plan-modal');
    }
    if (abrirModalActividad === true) {
        abrirModal('actividad-modal');
    }

    // ==================== VALIDACIONES Y FUNCIONALIDAD ESPEC√çFICA ====================

    // Auto-focus en primer campo del modal de actividad
    const actividadModal = document.getElementById('actividad-modal');
    if (actividadModal) {
        // Observer para detectar cuando se muestra el modal
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                    if (actividadModal.style.display === 'flex') {
                        const nombreInput = actividadModal.querySelector('input[name="nombre"]');
                        if (nombreInput) {
                            setTimeout(() => nombreInput.focus(), 100);
                        }
                    }
                }
            });
        });
        observer.observe(actividadModal, { attributes: true });
    }

    // Validaci√≥n del formulario de plan antes del env√≠o
    const planForm = document.querySelector('form[action*="guardarPlan"]');
    if (planForm) {
        planForm.addEventListener('submit', function(e) {
            const fechaInicio = document.getElementById('fechaInicio');
            const fechaFin = document.getElementById('fechaFin');
            const proyecto = document.getElementById('proyectoSelect');

            // Validar campos obligatorios
            if (!fechaInicio?.value || !fechaFin?.value || !proyecto?.value) {
                e.preventDefault();
                alert('Por favor complete todos los campos obligatorios.');
                return false;
            }

            // Validar fechas
            if (new Date(fechaFin.value) <= new Date(fechaInicio.value)) {
                e.preventDefault();
                alert('La fecha de fin debe ser posterior a la fecha de inicio.');
                return false;
            }

            // Verificar que hay al menos una actividad
            const listaActividades = document.getElementById('listaActividades');
            if (!listaActividades || listaActividades.children.length === 0) {
                e.preventDefault();
                alert('Debe agregar al menos una actividad al plan.');
                return false;
            }
        });
    }

    // ==================== SCROLL TO TOP ====================

    const scrollToTopBtn = document.getElementById('scroll-to-top');
    if (scrollToTopBtn) {
        scrollToTopBtn.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    }
});

// ==================== FUNCIONES GLOBALES ====================

/**
 * Funci√≥n para cerrar un modal espec√≠fico
 * @param {string} modalId - ID del modal a cerrar
 */
function cerrarModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'none';

        // Limpiar formulario de actividad cuando se cierra
        if (modalId === 'actividad-modal') {
            limpiarFormularioActividad();
        }
    }
}

/**
 * Funci√≥n para abrir un modal espec√≠fico
 * @param {string} modalId - ID del modal a abrir
 */
function abrirModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.style.display = 'flex';

        // Funcionalidad espec√≠fica al abrir ciertos modales
        if (modalId === 'actividad-modal') {
            // Focus en primer campo
            setTimeout(() => {
                const nombreInput = modal.querySelector('input[name="nombre"]');
                if (nombreInput) nombreInput.focus();
            }, 100);
        }
    }
}

/**
 * Funci√≥n para limpiar el formulario de actividad
 */
function limpiarFormularioActividad() {
    const form = document.querySelector('#actividad-modal form');
    if (form) {
        form.reset();
    }
}

// ==================== FUNCIONES AUXILIARES ====================

/**
 * Cerrar todos los modales
 */
function cerrarTodosLosModales() {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        modal.style.display = 'none';
    });
}

/**
 * Verificar si hay alg√∫n modal abierto
 * @returns {boolean} - true si hay al menos un modal abierto
 */
function hayModalAbierto() {
    const modals = document.querySelectorAll('.modal');
    return Array.from(modals).some(modal =>
        modal.style.display === 'flex' || modal.style.display === 'block'
    );
}

// ==================== EVENT LISTENERS GLOBALES ====================

// Cerrar modales con tecla ESC
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && hayModalAbierto()) {
        cerrarTodosLosModales();
    }
});

// Prevenir scroll del body cuando hay modal abierto
document.addEventListener('DOMContentLoaded', function() {
    const observer = new MutationObserver(function(mutations) {
        const modalAbierto = hayModalAbierto();
        document.body.style.overflow = modalAbierto ? 'hidden' : '';
    });

    // Observar cambios en todos los modales
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        observer.observe(modal, { attributes: true, attributeFilter: ['style'] });
    });
});
    function toggleActividades(button) {
    const planId = button.getAttribute('data-plan-id');
    const content = document.getElementById('actividades-' + planId);
    const toggleIcon = button.querySelector('.toggle-icon');

    if (!content || !toggleIcon) {
        console.error('Elementos no encontrados para plan:', planId);
        return;
    }

    // Cerrar otros desplegables abiertos
    document.querySelectorAll('.actividades-content.mostrar').forEach(otherContent => {
        if (otherContent !== content) {
            otherContent.classList.remove('mostrar');
            const otherButton = document.querySelector(`[data-plan-id="${otherContent.id.split('-')[1]}"]`);
            if (otherButton) {
                const otherIcon = otherButton.querySelector('.toggle-icon');
                if (otherIcon) {
                    otherIcon.classList.remove('fa-chevron-up');
                    otherIcon.classList.add('fa-chevron-down');
                }
            }
        }
    });

    // Toggle del desplegable actual
    const isVisible = content.classList.contains('mostrar');

    if (isVisible) {
        // Cerrar
        content.classList.remove('mostrar');
        toggleIcon.classList.remove('fa-chevron-up');
        toggleIcon.classList.add('fa-chevron-down');
    } else {
        // Abrir
        content.classList.add('mostrar');
        toggleIcon.classList.remove('fa-chevron-down');
        toggleIcon.classList.add('fa-chevron-up');

        // Ajustar posici√≥n si est√° cerca del borde
        setTimeout(() => {
            const rect = content.getBoundingClientRect();
            const windowWidth = window.innerWidth;

            if (rect.right > windowWidth - 20) {
                content.classList.add('align-right');
            } else {
                content.classList.remove('align-right');
            }
        }, 10);
    }
}



// Cerrar desplegables al hacer clic fuera
// Cerrar desplegables al hacer clic fuera
document.addEventListener('click', function(event) {
    if (!event.target.closest('.actividades-dropdown')) {
        document.querySelectorAll('.actividades-content.mostrar').forEach(content => {
            content.classList.remove('mostrar');

            // Resetear iconos
            const planId = content.id.split('-')[1];
            const button = document.querySelector(`[data-plan-id="${planId}"]`);
            if (button) {
                const icon = button.querySelector('.toggle-icon');
                if (icon) {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            }
        });
    }
});

    // Cerrar con tecla ESC
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        document.querySelectorAll('.actividades-content.mostrar').forEach(content => {
            content.classList.remove('mostrar');

            const planId = content.id.split('-')[1];
            const button = document.querySelector(`[data-plan-id="${planId}"]`);
            if (button) {
                const icon = button.querySelector('.toggle-icon');
                if (icon) {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            }
        });
    }
});

</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const iconoCampana = document.querySelector(".notification-icon");
        const dropdown = document.getElementById("notification-dropdown");
        const badge = document.getElementById("notificacion-count");

        // Toggle dropdown
        iconoCampana.addEventListener("click", function () {
            dropdown.style.display = dropdown.style.display === "none" ? "block" : "none";
        });

        // Cerrar el dropdown si se clickea fuera
        window.addEventListener("click", function (e) {
            if (!iconoCampana.contains(e.target)) {
                dropdown.style.display = "none";
            }
        });

        // Cargar notificaciones
        fetch('/api/notificaciones/usuario')
            .then(res => res.json())
            .then(data => {
                const lista = document.getElementById("notificacion-lista");
                lista.innerHTML = '';

                if (data.notificaciones.length === 0) {
                    lista.innerHTML = "<p style='text-align:center;'>Sin notificaciones</p>";
                } else {
                    data.notificaciones.forEach(n => {
                        const item = document.createElement("div");
                        item.className = "notificacion-item" + (n.leida ? "" : " unread");
                        item.innerHTML = `
                            <i class="${n.iconoTipo}" style="color: ${n.colorTipo};"></i>
                            <div>
                                <div>${n.mensaje}</div>
                                <small>${n.fechaCreacionFormateada}</small>
                            </div>
                        `;
                        lista.appendChild(item);
                    });
                }

                if (data.noLeidas > 0) {
                    badge.innerText = data.noLeidas;
                    badge.style.display = "inline-block";
                }
            })
            .catch(err => console.error("Error al cargar notificaciones:", err));
    });

    function marcarTodasLeidas() {
        fetch('/api/notificaciones/marcar-todas-leidas', {
            method: 'POST'
        }).then(() => location.reload());
    }
</script>

</body>
</html>
